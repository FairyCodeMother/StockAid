<% content_for :title, "Count Sheet for #{@sheet.bin.label}" %>
<% content_for :tabs, render("items/tabs") %>

<% content_for :content do %>
  <%= render partial: "inventory_reconciliations/notes" %>

  <%= form_tag inventory_reconciliation_count_sheet_path(@reconciliation, @sheet), method: :put, data: { guarded: true } do %>
    <table class="table table-hover table-striped">
      <thead>
        <tr>
          <th>Item</th>

          <% 1.upto @sheet.columns do |i| %>
            <th class="counter-column form-group">
              <input type="text" class="form-control" name="counter_names[]" placeholder="Counter Name" value="<%= @sheet.counter_names[i - 1] %>" data-guard="allOrNone" data-guard-all-or-none-group="allornone-<%= i %>" />
            </th>
          <% end %>

          <th class="minimal-width">
            <button type="button" class="btn btn-default add-counter-column"><i class="glyphicon glyphicon-plus"></i></button>
          </th>

          <th>
            Final
            <button type="button" class="btn btn-xs btn-default fill-final-count pull-right"><i class="glyphicon glyphicon-check"></i></button>
          </th>
        </tr>
      </thead>

      <tbody>
        <% @sheet.count_sheet_details.each do |detail| %>
          <tr data-count-sheet-detail-id="<%= detail.id %>">
            <td><%= detail.item.description %></td>

            <% 1.upto @sheet.columns do |i| %>
              <td class="form-group">
                <input type="text" class="form-control count" name="counts[<%= detail.id %>][]" placeholder="Count" value="<%= detail.counts[i - 1] %>" data-guard="int allOrNone" data-guard-int-min="0" data-guard-all-or-none-group="allornone-<%= i %>" />
              </td>
            <% end %>

            <td class="empty-column"></td>

            <td class="form-group">
              <input type="text" class="form-control final-count" name="final_counts[<%= detail.id %>]" placeholder="Final Count" value="<%= detail.final_count %>" data-guard="int" data-guard-int-min="0" />
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <div class="row">
      <div class="col-xs-12">
        <input type="submit" class="btn btn-primary" name="save" value="Save" />
        <input type="submit" class="btn btn-danger pull-right" name="complete" value="Complete" />
      </div>
    </div>
  <% end %>
<% end %>
